// This is your Prisma schema file
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         String   @id @default(cuid())
  username   String   @unique
  email      String   @unique
  password   String
  isAdmin    Boolean  @default(false)
  isApproved Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  ratings    Rating[]
  notes      Note[]
}

model Show {
  id          String    @id @default(cuid())
  title       String   @unique
  description String?   @db.Text
  order       Int?
  artworkUrl  String?
  imdbRating  Float?
  runtime     Int?      // total minutes across all seasons/episodes
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  seasons     Season[]
  notes       Note[]
  ratings     Rating[]
  watchStatus WatchProgress[]
}

model Season {
  id          String    @id @default(cuid())
  number      Int
  show        Show      @relation(fields: [showId], references: [id], onDelete: Cascade)
  showId      String
  imdbRating  Float?
  artworkUrl  String?
  runtime     Int?      // total minutes across all episodes in this season
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  episodes    Episode[]
  notes       Note[]
  ratings     Rating[]
  watchStatus WatchProgress[]

  @@unique([showId, number])
}

model Episode {
  id            String    @id @default(cuid())
  title         String
  episodeNumber Int
  season        Season    @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  seasonId      String
  airDate       DateTime?
  artworkUrl    String?
  imdbRating    Float?
  description   String?   @db.Text
  runtime       Int?      // minutes
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  ratings       Rating[]
  notes         Note[]
  watchStatus   WatchProgress[]

  @@unique([seasonId, episodeNumber])
}

model Movie {
  id           String    @id @default(cuid())
  title        String   @unique
  releaseDate  DateTime?
  description  String?   @db.Text
  order        Int?
  artworkUrl   String?
  imdbRating   Float?
  runtime      Int?      // minutes
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  ratings      Rating[]
  notes        Note[]
  watchStatus  WatchProgress[]
}

model Rating {
  id        String    @id @default(cuid())
  value     Float
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  episode   Episode?  @relation(fields: [episodeId], references: [id], onDelete: Cascade)
  episodeId String?
  movie     Movie?    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  movieId   String?
  season    Season?   @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  seasonId  String?
  show      Show?     @relation(fields: [showId], references: [id], onDelete: Cascade)
  showId    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([userId, episodeId])
  @@unique([userId, movieId])
  @@unique([userId, seasonId])
  @@unique([userId, showId])
}

model Note {
  id        String    @id @default(cuid())
  content   String    @db.Text
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  episode   Episode?  @relation(fields: [episodeId], references: [id], onDelete: Cascade)
  episodeId String?
  movie     Movie?    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  movieId   String?
  season    Season?   @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  seasonId  String?
  show      Show?     @relation(fields: [showId], references: [id], onDelete: Cascade)
  showId    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model WatchProgress {
  id        String    @id @default(cuid())
  watched   Boolean   @default(false)
  episode   Episode?  @relation(fields: [episodeId], references: [id], onDelete: Cascade)
  episodeId String?
  movie     Movie?    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  movieId   String?
  season    Season?   @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  seasonId  String?
  show      Show?     @relation(fields: [showId], references: [id], onDelete: Cascade)
  showId    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([episodeId])
  @@unique([movieId])
  @@unique([seasonId])
  @@unique([showId])
}
